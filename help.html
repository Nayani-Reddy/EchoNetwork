<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Help-Seeker Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }
    input, textarea, button, select { margin: 5px 0; padding: 8px; width: 300px; }
    h1,h2,h3 { margin-top:0; }
    header { display:flex; justify-content:space-between; align-items:center; padding-bottom:10px; border-bottom:1px solid #ccc;}
    main { max-width:900px; margin:auto; }
    section.card { background:#f9f9f9; padding:15px; margin-bottom:20px; border-radius:6px; box-shadow:0 2px 4px rgba(0,0,0,0.1);}
    label { display:block; margin-top:10px; }
    #map { height:400px; width:100%; margin-top:10px; border:1px solid #ccc; border-radius:6px;}
    button.emergency { background:#d9534f; color:white; border:none; padding:10px 20px; cursor:pointer; border-radius:4px;}
    button.emergency:hover { background:#c9302c; }
    .faq-question { cursor:pointer; color:#0078A8; margin:5px 0;}
    .faq-answer { display:none; margin:5px 0 15px 10px; color:#333; }
    .timer { font-size:0.9em; color:red; margin-left:5px; }
    @media(max-width:600px){ input,textarea,button,select{width:100%;} }
  </style>
</head>
<body>
  <header>
    <h1>Help-Seeker Dashboard</h1>
    <a class="back-btn" id="logoutBtn">â¬… Logout</a>
  </header>

  <main>
    <section class="card">
      <h2>âž• Add New Request</h2>
      <label for="reqTitle">Select Sector:</label>
      <select id="reqTitle" onchange="showDescription()">
        <option value="">--Select Sector--</option>
        <option value="Health">Health</option>
        <option value="Education">Education</option>
        <option value="Food">Food</option>
        <option value="Disaster Management">Disaster Management</option>
        <option value="Clothing">Clothing</option>
        <option value="Workshops">Workshops</option>
        <option value="Shelter">Shelter</option>
        <option value="Employment">Employment</option>
        <option value="Livelihood">Livelihood</option>
        <option value="Hygiene">Hygiene</option>
        <option value="Legal">Legal</option>
      </select>
      <div id="descriptionDiv" style="display:none;">
        <label for="reqDetails">Describe your need in this sector:</label>
        <textarea id="reqDetails" placeholder="Describe your request"></textarea>
        <label><input type="checkbox" id="emergencyCheckbox"> Mark as Emergency</label>
      </div>
      <button onclick="submitRequest()">Submit Request</button>
      <h3>Preview Location</h3>
      <div id="map"></div>
    </section>

    <section class="card">
      <h2>ðŸ“Œ Request Live Status</h2>
      <div id="liveStatus">No active requests</div>
    </section>

    <section class="card">
      <h2>ðŸ“– Past Request History</h2>
      <div id="pastRequests">No past requests yet</div>
    </section>

    <section class="card">
      <h2>ðŸ’¬ Feedback & Rating</h2>
      <label for="donorSelect">Select Volunteer:</label>
      <select id="donorSelect">
        <option value="">-- Select Volunteer --</option>
      </select>
      <label>Rating:</label>
      <select id="ratingSelect">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
      <textarea id="feedbackText" placeholder="Write feedback..."></textarea>
      <button onclick="submitFeedback()">Submit Feedback</button>
    </section>

    <section class="card">
      <h2>ðŸš¨ Emergency Request</h2>
      <button class="emergency" onclick="sendEmergency()">Send Emergency Request</button>
    </section>

    <section class="card">
      <h2>ðŸ¤– FAQ / Chatbot</h2>
      <label for="faqLang">Choose Language:</label>
      <select id="faqLang">
        <option value="english">English</option>
        <option value="hindi">Hindi</option>
        <option value="telugu">Telugu</option>
        <option value="marathi">Marathi</option>
        <option value="tamil">Tamil</option>
      </select>
      <div id="faqContainer"></div>
    </section>

    <section class="card">
      <h2>ðŸ—“ Integrated Calendar</h2>
      <div id="helpCalendar"></div>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <script>
    const user=JSON.parse(sessionStorage.getItem("currentUser"))||{name:"TestUser",role:"help"};
    if(!user||user.role!=="help") window.location.href="login.html";

    // Map
    let map,userMarker=null,currentLat=null,currentLon=null;
    function initMap(lat,lon){
      map=L.map('map').setView([lat,lon],16);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap contributors'}).addTo(map);
      userMarker=L.marker([lat,lon]).addTo(map).bindPopup("Your location").openPopup();
    }
    navigator.geolocation.getCurrentPosition(pos=>{
      currentLat=pos.coords.latitude; currentLon=pos.coords.longitude; initMap(currentLat,currentLon);
    },()=>{ currentLat=12.9939; currentLon=80.2333; initMap(currentLat,currentLon); });

    function showDescription(){ document.getElementById("descriptionDiv").style.display=document.getElementById("reqTitle").value?"block":"none"; }

    function submitRequest(){
      const title=document.getElementById("reqTitle").value;
      const details=document.getElementById("reqDetails").value.trim();
      const isEmergency=document.getElementById("emergencyCheckbox").checked;
      if(!title||!details){ alert("Select category and describe request"); return; }
      const requests=JSON.parse(localStorage.getItem("requests"))||[];
      requests.push({id:Date.now(),title,details,lat:currentLat,lon:currentLon,by:user.name,status:"Pending",emergency:isEmergency,timestamp:Date.now()});
      localStorage.setItem("requests",JSON.stringify(requests));
      document.getElementById("reqTitle").value="";
      document.getElementById("reqDetails").value="";
      document.getElementById("descriptionDiv").style.display="none";
      document.getElementById("emergencyCheckbox").checked=false;
      renderLiveRequests();
    }

    function renderLiveRequests(){
      let requests=JSON.parse(localStorage.getItem("requests"))||[];
      requests=requests.filter(r=>r.by===user.name && r.status!=="Completed");
      const container=document.getElementById("liveStatus");
      if(requests.length===0){ container.innerHTML="No active requests"; return; }
      container.innerHTML=requests.map(r=>{
        let timerHTML="";
        if(!r.emergency){
          const diff=24*60*60*1000-(Date.now()-r.timestamp);
          if(diff>0){
            const hrs=Math.floor(diff/3600000),mins=Math.floor((diff%3600000)/60000),secs=Math.floor((diff%60000)/1000);
            timerHTML=`<span class="timer">${hrs}h ${mins}m ${secs}s left</span>`;
          } else timerHTML=`<span class="timer">Expired</span>`;
        }
        return `<div>
          <strong>${r.title}</strong> ${r.emergency?'<span style="color:red;">â›”</span>':''}<br>
          ${r.details}<br>Status: <em>${r.status}</em> ${timerHTML}<br>
          ${r.status!=="Completed"?`<button onclick="markDone(${r.id})">Mark as Done</button>`:""}
        </div><hr/>`;
      }).join("");
    }

    function renderPastRequests(){
      const past=JSON.parse(localStorage.getItem("pastRequests"))||[];
      const container=document.getElementById("pastRequests");
      if(past.length===0){ container.innerHTML="No past requests yet"; return; }
      container.innerHTML=past.map(r=>`<div><strong>${r.title}</strong> by ${r.volunteer||'N/A'}<br>${r.details}<br>Status: <em>${r.status}</em></div>`).join("");
    }

    function markDone(id){
      const requests=JSON.parse(localStorage.getItem("requests"))||[];
      const past=JSON.parse(localStorage.getItem("pastRequests"))||[];
      const idx=requests.findIndex(r=>r.id===id);
      if(idx!==-1){
        requests[idx].status="Completed";
        past.push(requests[idx]);
        localStorage.setItem("requests",JSON.stringify(requests));
        localStorage.setItem("pastRequests",JSON.stringify(past));
        renderLiveRequests();
        renderPastRequests();
        alert("Task completed! Provide feedback below.");
        updateVolunteerDropdown();
      }
    }

    function submitFeedback(){
      const volunteer=document.getElementById("donorSelect").value;
      const feedback=document.getElementById("feedbackText").value.trim();
      const rating=parseInt(document.getElementById("ratingSelect").value);
      if(!volunteer||!feedback){ alert("Select volunteer and provide feedback"); return; }
      const requests=JSON.parse(localStorage.getItem("requests"))||[];
      const idx=requests.findIndex(r=>r.volunteer===volunteer && r.status==="Completed");
      if(idx!==-1){
        requests[idx].feedback=feedback;
        requests[idx].rating=rating;
        localStorage.setItem("requests",JSON.stringify(requests));
        alert("Feedback submitted!");
        document.getElementById("feedbackText").value="";
        renderPastRequests();
      }
    }

    function sendEmergency(){ alert("Emergency request sent!"); }

    function updateVolunteerDropdown(){
      const volunteers=[...new Set(JSON.parse(localStorage.getItem("requests")||[]).filter(r=>r.status==="Completed" && r.volunteer).map(r=>r.volunteer))];
      const sel=document.getElementById("donorSelect");
      sel.innerHTML=`<option value="">-- Select Volunteer --</option>`+volunteers.map(v=>`<option value="${v}">${v}</option>`).join("");
    }

    // Calendar
    const calendar=new FullCalendar.Calendar(document.getElementById("helpCalendar"),{initialView:"dayGridMonth"});
    calendar.render();

    // Chatbot FAQs
    const faqs={
      english:[
        {q:"What is this platform?",a:"A place to get help from volunteers."},
        {q:"How do I submit a request?",a:"Select sector, describe need, submit."},
        {q:"Can I see volunteer location?",a:"Yes, volunteers can see your location."},
        {q:"How do I give feedback?",a:"Select volunteer and write feedback below."},
        {q:"What if it's an emergency?",a:"Use emergency request button to alert volunteers immediately."}
      ],
      hindi:[
        {q:"à¤¯à¤¹ à¤ªà¥à¤²à¥‡à¤Ÿà¤«à¤¼à¥‰à¤°à¥à¤® à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?",a:"à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤•à¥‹à¤‚ à¤¸à¥‡ à¤®à¤¦à¤¦ à¤ªà¤¾à¤¨à¥‡ à¤•à¤¾ à¤¸à¥à¤¥à¤¾à¤¨à¥¤"},
        {q:"à¤®à¥ˆà¤‚ à¤…à¤¨à¥à¤°à¥‹à¤§ à¤•à¥ˆà¤¸à¥‡ à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤°à¥‚à¤?",a:"à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤šà¥à¤¨à¥‡à¤‚, à¤µà¤¿à¤µà¤°à¤£ à¤²à¤¿à¤–à¥‡à¤‚ à¤”à¤° à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤°à¥‡à¤‚à¥¤"},
        {q:"à¤•à¥à¤¯à¤¾ à¤®à¥ˆà¤‚ à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤• à¤•à¤¾ à¤¸à¥à¤¥à¤¾à¤¨ à¤¦à¥‡à¤– à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤?",a:"à¤¹à¤¾à¤, à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤• à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤¥à¤¾à¤¨ à¤¦à¥‡à¤– à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤"},
        {q:"à¤®à¥ˆà¤‚ à¤«à¥€à¤¡à¤¬à¥ˆà¤• à¤•à¥ˆà¤¸à¥‡ à¤¦à¥‚à¤?",a:"à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤• à¤šà¥à¤¨à¥‡à¤‚ à¤”à¤° à¤¨à¥€à¤šà¥‡ à¤«à¥€à¤¡à¤¬à¥ˆà¤• à¤²à¤¿à¤–à¥‡à¤‚à¥¤"},
        {q:"à¤†à¤ªà¤¾à¤¤ à¤¸à¥à¤¥à¤¿à¤¤à¤¿ à¤®à¥‡à¤‚ à¤•à¥à¤¯à¤¾ à¤•à¤°à¥‡à¤‚?",a:"à¤†à¤ªà¤¾à¤¤ à¤¸à¥à¤¥à¤¿à¤¤à¤¿ à¤¬à¤Ÿà¤¨ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤•à¥‹à¤‚ à¤•à¥‹ à¤¤à¥à¤°à¤‚à¤¤ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤°à¥‡à¤‚à¥¤"}
      ],
      telugu:[
        {q:"à°ˆ à°ªà±à°²à°¾à°Ÿà±â€Œà°«à°¾à°°à°‚ à°à°®à°¿à°Ÿà°¿?",a:"à°¸à±‡à°µà°¾à°•à°¾à°°à±à°² à°¨à±à°‚à°¡à°¿ à°¸à°¹à°¾à°¯à°‚ à°ªà±Šà°‚à°¦à°¡à°¾à°¨à°¿à°•à°¿ à°¸à±à°¥à°²à°‚."},
        {q:"à°…à°¨à±à°°à±‹à°§à°‚ à°Žà°²à°¾ à°¸à°®à°°à±à°ªà°¿à°‚à°šà°¾à°²à°¿?",a:"à°µà°¿à°­à°¾à°—à°‚ à°Žà°‚à°šà±à°•à±‹à°‚à°¡à°¿, à°µà°¿à°µà°°à°¿à°‚à°šà°‚à°¡à°¿, à°¸à°®à°°à±à°ªà°¿à°‚à°šà°‚à°¡à°¿."},
        {q:"à°¨à±‡à°¨à± à°¸à±‡à°µà°¾à°•à°¾à°°à°¿ à°¸à±à°¥à°¾à°¨à°‚ à°šà±‚à°¡à°—à°²à°¨à°¾?",a:"à°…à°µà±à°¨à±, à°¸à±‡à°µà°¾à°•à°¾à°°à±à°²à± à°®à±€ à°¸à±à°¥à°¾à°¨à°‚ à°šà±‚à°¡à°—à°²à°°à±."},
        {q:"à°«à±€à°¡à±à°¬à±à°¯à°¾à°•à± à°Žà°²à°¾ à°‡à°µà±à°µà°¾à°²à°¿?",a:"à°¸à±‡à°µà°¾à°•à°¾à°°à°¿à°¨à°¿ à°Žà°‚à°šà±à°•à±‹à°‚à°¡à°¿, à°«à±€à°¡à±à°¬à±à°¯à°¾à°•à± à°µà±à°°à°¾à°¯à°‚à°¡à°¿."},
        {q:"à°¤à°•à±à°·à°£ à°¸à°¹à°¾à°¯à°‚ à°…à°µà°¸à°°à°®à±ˆà°¤à±‡?",a:"à°Žà°®à°°à±à°œà±†à°¨à±à°¸à±€ à°¬à°Ÿà°¨à± à°‰à°ªà°¯à±‹à°—à°¿à°‚à°šà°‚à°¡à°¿."}
      ],
      marathi:[
        {q:"à¤¹à¥‡ à¤ªà¥à¤²à¥…à¤Ÿà¤«à¥‰à¤°à¥à¤® à¤•à¤¾à¤¯ à¤†à¤¹à¥‡?",a:"à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤•à¤¾à¤‚à¤•à¤¡à¥‚à¤¨ à¤®à¤¦à¤¤ à¤®à¤¿à¤³à¤µà¤£à¥à¤¯à¤¾à¤šà¥‡ à¤ à¤¿à¤•à¤¾à¤£."},
        {q:"à¤®à¥€ à¤µà¤¿à¤¨à¤‚à¤¤à¥€ à¤•à¤¶à¥€ à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤°à¥?",a:"à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤¨à¤¿à¤µà¤¡à¤¾, à¤¤à¤ªà¤¶à¥€à¤² à¤¦à¥à¤¯à¤¾, à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤°à¤¾."},
        {q:"à¤®à¥€ à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤•à¤¾à¤šà¥€ à¤œà¤¾à¤—à¤¾ à¤ªà¤¾à¤¹à¥‚ à¤¶à¤•à¤¤à¥‹?",a:"à¤¹à¥‹, à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤• à¤¤à¥à¤®à¤šà¥€ à¤œà¤¾à¤—à¤¾ à¤ªà¤¾à¤¹à¥‚ à¤¶à¤•à¤¤à¤¾à¤¤."},
        {q:"à¤®à¥€ à¤«à¥€à¤¡à¤¬à¥…à¤• à¤•à¤¸à¤¾ à¤¦à¥à¤¯à¤¾à¤µà¤¾?",a:"à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤• à¤¨à¤¿à¤µà¤¡à¤¾ à¤†à¤£à¤¿ à¤«à¥€à¤¡à¤¬à¥…à¤• à¤¦à¥à¤¯à¤¾."},
        {q:"à¤†à¤ªà¤¤à¥à¤•à¤¾à¤²à¥€à¤¨ à¤¸à¥à¤¥à¤¿à¤¤à¥€à¤¤ à¤•à¤¾à¤¯ à¤•à¤°à¤¾à¤µà¥‡?",a:"à¤†à¤ªà¤¤à¥à¤•à¤¾à¤²à¥€à¤¨ à¤¬à¤Ÿà¤£ à¤µà¤¾à¤ªà¤°à¥‚à¤¨ à¤¸à¥à¤µà¤¯à¤‚à¤¸à¥‡à¤µà¤•à¤¾à¤‚à¤¨à¤¾ à¤¤à¥à¤µà¤°à¤¿à¤¤ à¤¸à¥‚à¤šà¤¿à¤¤ à¤•à¤°à¤¾."}
      ],
      tamil:[
        {q:"à®‡à®¨à¯à®¤ à®¤à®³à®®à¯ à®Žà®©à¯à®©?",a:"à®¤à®©à¯à®©à®¾à®°à¯à®µà®²à®°à¯à®•à®³à®¿à®Ÿà®®à®¿à®°à¯à®¨à¯à®¤à¯ à®‰à®¤à®µà®¿ à®ªà¯†à®±à¯à®®à¯ à®‡à®Ÿà®®à¯."},
        {q:"à®¨à®¾à®©à¯ à®•à¯‹à®°à®¿à®•à¯à®•à¯ˆà®¯à¯ˆ à®Žà®ªà¯à®ªà®Ÿà®¿à®šà¯ à®šà®®à®°à¯à®ªà¯à®ªà®¿à®ªà¯à®ªà¯‡à®©à¯?",a:"à®¤à¯à®±à¯ˆà®¯à¯ˆ à®¤à¯‡à®°à¯à®µà¯ à®šà¯†à®¯à¯à®¤à¯ à®µà®¿à®µà®°à®¿à®•à¯à®•à®µà¯à®®à¯, à®šà®®à®°à¯à®ªà¯à®ªà®¿à®•à¯à®•à®µà¯à®®à¯."},
        {q:"à®¨à®¾à®©à¯ à®¤à®©à¯à®©à®¾à®°à¯à®µà®²à®°à®¿à®©à¯ à®‡à®Ÿà®¤à¯à®¤à¯ˆ à®ªà®¾à®°à¯à®•à¯à®• à®®à¯à®Ÿà®¿à®¯à¯à®®à®¾?",a:"à®†à®®à¯, à®¤à®©à¯à®©à®¾à®°à¯à®µà®²à®°à¯à®•à®³à¯ à®‰à®™à¯à®•à®³à¯ à®‡à®Ÿà®¤à¯à®¤à¯ˆ à®ªà®¾à®°à¯à®•à¯à®• à®®à¯à®Ÿà®¿à®¯à¯à®®à¯."},
        {q:"à®•à®°à¯à®¤à¯à®¤à¯ à®Žà®ªà¯à®ªà®Ÿà®¿à®šà¯ à®šà¯†à®¯à¯à®¯à®²à®¾à®®à¯?",a:"à®¤à®©à¯à®©à®¾à®°à¯à®µà®²à®°à¯ˆ à®¤à¯‡à®°à¯à®µà¯ à®šà¯†à®¯à¯à®¤à¯ à®•à®°à¯à®¤à¯à®¤à¯ à®Žà®´à¯à®¤à®µà¯à®®à¯."},
        {q:"à®…à®µà®šà®°à®¤à¯à®¤à®¿à®²à¯ à®Žà®©à¯à®© à®šà¯†à®¯à¯à®¯ à®µà¯‡à®£à¯à®Ÿà¯à®®à¯?",a:"à®…à®µà®šà®° à®ªà¯Šà®¤à¯à®¤à®¾à®©à¯ˆ à®…à®´à¯à®¤à¯à®¤à®¿ à®‰à®Ÿà®©à®Ÿà®¿ à®…à®±à®¿à®µà®¿à®ªà¯à®ªà¯ à®…à®©à¯à®ªà¯à®ªà®µà¯à®®à¯."}
      ]
    };

    document.getElementById("faqLang").addEventListener("change",renderFAQ);
    function renderFAQ(){
      const lang=document.getElementById("faqLang").value;
      const container=document.getElementById("faqContainer");
      container.innerHTML=faqs[lang].map(f=>`<div class="faq-question">${f.q}</div><div class="faq-answer">${f.a}</div>`).join("");
      document.querySelectorAll(".faq-question").forEach(q=>{
        q.addEventListener("click",()=>{ q.nextElementSibling.style.display=q.nextElementSibling.style.display==="block"?"none":"block"; });
      });
    }
    renderFAQ();

    // Logout
    document.getElementById("logoutBtn").addEventListener("click",()=>{ sessionStorage.clear(); window.location.href="login.html"; });

    // Initial load
    renderLiveRequests();
    renderPastRequests();
    updateVolunteerDropdown();

    window.addEventListener("storage",()=>{
      renderLiveRequests();
      renderPastRequests();
      updateVolunteerDropdown();
    });

    setInterval(renderLiveRequests,1000); // update timers
  </script>
</body>
</html>
â€¨